<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Portfolio Optimization with Python - Part I | MM</title><meta name=keywords content="MOSEK,Python,Portfolio Optimization,Efficient Frontier,Backtesting,Backtrader"><meta name=description content="Introduction to portfolio optimization using MOSEK's Fusion API."><meta name=author content="Matias Macazaga"><link rel=canonical href=https://matimacazaga.github.io/posts/portfolio_optimization/><link crossorigin=anonymous href=/assets/css/stylesheet.6f3393efeb1932ac5e626c481ab86d6698c5984b7efc1e55c5a8e51fb4958e8b.css integrity="sha256-bzOT7+sZMqxeYmxIGrhtZpjFmEt+/B5VxajlH7SVjos=" rel="preload stylesheet" as=style><link rel=icon href=https://matimacazaga.github.io/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://matimacazaga.github.io/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://matimacazaga.github.io/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://matimacazaga.github.io/favicon/apple-touch-icon.png><link rel=mask-icon href=https://matimacazaga.github.io/favicon/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Portfolio Optimization with Python - Part I"><meta property="og:description" content="Introduction to portfolio optimization using MOSEK's Fusion API."><meta property="og:type" content="article"><meta property="og:url" content="https://matimacazaga.github.io/posts/portfolio_optimization/"><meta property="og:image" content="https://matimacazaga.github.io/img/portfolio_optimization.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-10-10T00:00:00+00:00"><meta property="article:modified_time" content="2022-10-10T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://matimacazaga.github.io/img/portfolio_optimization.png"><meta name=twitter:title content="Portfolio Optimization with Python - Part I"><meta name=twitter:description content="Introduction to portfolio optimization using MOSEK's Fusion API."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://matimacazaga.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Portfolio Optimization with Python - Part I","item":"https://matimacazaga.github.io/posts/portfolio_optimization/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Portfolio Optimization with Python - Part I","name":"Portfolio Optimization with Python - Part I","description":"Introduction to portfolio optimization using MOSEK's Fusion API.","keywords":["MOSEK","Python","Portfolio Optimization","Efficient Frontier","Backtesting","Backtrader"],"articleBody":"This is the first part of the Portfolio Optimization with Python series. The intend is to make a deep dive into the field and study some real-world applications with Python. Throughout the series, I’ll be using MOSEK library for solving the optimization problems and Backtrader for backtesting the portfolio management strategies.\nThis time, I’ll make a brief introduction to the Markowitz Portfolio Optimization framework so you start to familiarize with the relevant concepts. At the end, I’ll show you a simple function building the Markowitz Mean-Variance portfolio using MOSEK and finding the optimal weights and efficient frontier.\nMarkowitz Portfolio Optimization Let’s consider an investor who wishes to allocate capital among \\(N\\) securities at time \\(t=0\\) and hold them over a single period of time \\(t=h\\). Moreover, assume that the investor is risk-averse, that is, he/she is looking to maximize the return of the investment while trying to keep the investment risk on an acceptable level. We can think of the risk as the uncertainty of the future portfolio returns.\nThe investment risk can be decomposed into two components: the specific risk and the systematic risk. We can’t do much with the systematic risk part: the only way of reducing it is by decreasing the expected return of the portfolio. On the other hand, the specific risk, or the risk associated with each of the securities in the portfolio, can be reduced through diversification for a fixed expected return. Markowitz Theory (also known as Modern Portfolio Theory) formalizes this process by using the variance as a measure of portfolio risk, and constructing an optimization problem whose solution are the optimal portfolio weights for the given inputs and constraints (more on this later).\nBefore I go any further, let me define some important quantities:\n\\(p_{0,i}\\): the known price of a security \\(i\\) at the beginning of the investment period. \\(P_{h,i}\\): the random price of the security \\(i\\) at the end of the investment period \\(h\\). The rate of return of the security \\(i\\) over the investment period \\(h\\), modeled by the random variable \\[R_{i}=\\dfrac{P_{h,i}}{p_{0,i}}-1\\]\nThe expected value of the rate of return of the security \\(i\\) \\[ \\mu_{i} = \\mathbb{E}(R_{i}) \\]\nThe portfolio vector \\(\\mathbf{x}\\in\\mathbb{R}^{N}\\), where \\(N\\) is the number of symbols and \\(x_{i}\\) is the proportion of funds invested into security \\(i\\). The random portfolio return \\[R_{\\mathbf{x}}=\\sum_{i}^{N}x_{i}R_{i}=\\mathbf{x}^{T}R,\\]\nwhere \\(\\mathbf{R}=[R_{1}, \\dots, R_{i}, \\dots, R_{N}]^{T}\\) is the vector of asset’s returns.\nThe expected portfolio return \\[\\mu_{\\mathbf{x}}=\\mathbb{E}(R_{\\mathbf{x}})=\\mathbf{x}^{T}\\mathbb{E}(R)=\\mathbf{x}^{T}\\mathbf{\\mu},\\]\nwhere \\(\\mathbf{\\mu}\\) is the vector of expected returns.\nThe portfolio variance \\[\\sigma_{\\mathbf{x}}^{2} = \\text{Var}(R_{\\mathbf{x}}) = \\sum_{i}^{N}\\text{Cov}(R_{i}, R_{j})x_{i}x_{j}=\\mathbf{x}^{T}\\mathbf{\\Sigma}\\mathbf{x},\\]\nwhere \\(\\mathbf{\\Sigma}\\) is the covariance matrix of returns.\nBased on these quantities, we can state the portfolio optimization problem defined above as\n\\[\\begin{array}{lr}\\text{minimize} \u0026 \\mathbf{x}^{T}\\mathbf{\\Sigma}\\mathbf{x}\\\\ \\text{subject to} \u0026 \\mathbf{\\mu}^{T}\\mathbf{x} \\geq r_{min} \\\\ \u0026 \\mathbf{1}^{T}\\mathbf{x} = 1\\end{array}\\]\nThat is, minimize the variance of the portfolio given a minimum required portfolio return \\(r_{min}\\) and the budget constraint \\(\\mathbf{1}^{T}\\mathbf{x} = \\sum_{i}^{N} x_{i} = 1\\), which means that the portfolio is fully invested. Given this, the optimization problem is also referred as Mean-Variance Optimization (MVO).\nUsing the input parameters \\(\\mathbf{\\mu}\\) and \\(\\mathbf{\\Sigma}\\), MVO seeks to find a portfolio of assets \\(\\mathbf{x}\\) in such a way that it seeks the optimal trade-off between expected portfolio return and portfolio risk. There are two alternative formulations to the problem statement given above:\nMaximize expected return for a risk level \\[ \\begin{array}{lr} \\text{maximize} \u0026 \\mathbf{\\mu}^{T}\\mathbf{x} \\\\ \\text{subject to} \u0026 \\mathbf{x}^{T}\\mathbf{\\Sigma x}\\leq \\gamma^{2} \\\\ \u0026 \\mathbf{1}^{T}\\mathbf{x} = 1,\\end{array} \\]\nwhere \\(\\gamma^{2}\\) is an upper bound on the portfolio risk.\nMaximize the utility function of the investor \\[ \\begin{array}{lr} \\text{maximize} \u0026 \\mathbf{\\mu}^{T}\\mathbf{x} - \\dfrac{\\delta}{2}\\mathbf{x}^{T}\\mathbf{\\Sigma x} \\\\ \\text{subject to} \u0026 \\mathbf{1}^{T}\\mathbf{x} = 1,\\end{array} \\]\nwhere \\(\\delta\\) is the risk-aversion coefficient. The problem with this formulation is that the risk coefficient does not have an intuitive investment meaning for the investor. However, if we reformulate the problem using the standard deviation\n\\[ \\begin{array}{lr} \\text{maximize} \u0026 \\mathbf{\\mu}^{T}\\mathbf{x} - \\tilde{\\delta}\\sqrt{\\mathbf{x}^{T}\\mathbf{\\Sigma x}} \\\\ \\text{subject to} \u0026 \\mathbf{1}^{T}\\mathbf{x} = 1,\\end{array} \\label{9} \\]\nand assume that the portfolio return is normally distributed, then \\(\\tilde{\\delta}\\) is the z-score of portfolio return, that is, the distance from the mean measured in units of standard deviation. We can see that for \\(\\tilde{\\delta}=0\\), we maximize expected portfolio return. Then, by increasing \\(\\tilde{\\delta}\\), we put more and more weight on tail risk, i.e., we maximize a lower and lower quantile of portfolio return.\nAll the formulations above will result in the same set of optimal solutions. The optimal portfolio \\(\\mathbf{x}\\) is said to be efficient in the sense that there is no other portfolio giving a strictly higher return for the same amount of risk (variance). The collection of such points (portfolios) is known as the efficient frontier in the mean return-variance space.\nWe can use the method of Lagrangian multipliers to obtain a closed-form solution for the optimization problem above. However, in the investment practice it is common to include additional constraints in the form of linear and convex equalities or inequalities. Examples of constraints are diversification constraints, leverage constraints, turnover constraints, among others. Furthermore, extra objective function terms can be included for representing restrictions on the optimal weights. In these more realistic use cases, it is compulsory to use numerical optimization algorithms for finding the optimal solution.\nDiversification constraints We will focus our attention on diversification constraints, which help to limit portfolio risk by restricting the exposure to individual positions or sectors.\nFor a single position \\(i\\), we have\n\\[ l_{i} \\leq x_{i} \\leq u_{i}, \\]\nwhere \\(l_{i}\\) is the lower bound and \\(u_{i}\\) the upper one.\nOn the other hand, for a sector or group of assets \\(\\mathcal{I}\\), we have\n\\[ l_{i} \\leq \\sum_{i\\in\\mathcal{I}}x_{i}\\leq u_{i} \\]\nNote that the constraints of the type greater than (similar for constraints of the type less than) that apply to all the assets can be expressed in matrix form as\n\\[ \\mathbf{I}^{N\\times N} \\mathbf{x} \\leq \\mathbf{1}_{N} u \\]\nwhere \\(\\mathbf{I}^{N\\times N}\\) is the identity matrix with \\(N\\) columns and rows, \\(\\mathbf{1}_{N}\\) is an \\(N\\)-dimensional vector of ones and \\(u\\) is the upper bound.\nAdditionally, greater than constraints (similar for less than constraints) for assets in a specific sector can be expressed as\n\\[ \\mathbf{1}_{i\\in\\mathcal{I}}^{T}\\mathbf{x} \\leq u \\]\nwhere \\(\\mathbf{1}_{i\\in\\mathcal{I}}^{T}\\) is an \\(N\\)-dimensional vector whose values are \\(1\\) if the asset \\(i\\) belongs to the sector \\(\\mathcal{I}\\) or \\(0\\) if not.\nFinally, greater than (or similarly less than) constraints for a specific asset can be expressed as\n\\[\\mathbf{1}_{i=j}^{T}\\mathbf{x} \\leq u \\]\nwhere \\(\\mathbf{1}_{i=j}^{T}\\mathbf{x}\\) is an \\(N\\)-dimensional vector whose values are \\(1\\) only for the asset \\(j\\) of interest\nConic formulation The portfolio optimization problems stated above are quadratic optimization (QO) problems. Solving QO in their original form is popular and considered easy. However, more recent results showed that conic optimization models can improve QO models both in the theoretical and in the practical sense.\nConic (quadratic) optimization, also known as second-order cone optimization, is a straightforward generalization of linear optimization, meaning that we optimize a linear function under linear (in)equalities with some variables belonging to one or more quadratic cones.\nAn \\(n\\)-dimensional quadratic cone is defined as\n\\[ \\mathcal{Q}^{n} = \\left\\{ x \\in \\mathbb{R}^{n} | x_{1} \\geq \\sqrt{x_{2}^{2} + x_{3}^{2} + \\cdots + x_{n}^{2}} \\right\\} \\]\nExample of the geometric interpretation of a quadratic cone and a rotated quadratic cone (not discussed here) with three variables. source\nHaving this in mind and assuming that the covariance matrix \\( \\mathbf{\\Sigma} \\) is positive definite such that\n\\[ \\mathbf{\\Sigma} = \\mathbf{G}\\mathbf{G}^{T}, \\ \\ \\ \\mathbf{G}\\in\\mathbb{R}^{N\\times k}\\]\nwe can write the portfolio variance as\n\\[ \\mathbf{x}^{T}\\mathbf{\\Sigma x} = \\mathbf{x}^{T}\\mathbf{G}\\mathbf{G}^{T}x = ||\\mathbf{G}^{T}\\mathbf{x}||_{2}^{2}. \\]\nWe can find the conic equivalent of the problem in Eq. \\( (\\ref{9})\\) by introducing a variable \\(s\\) to represent the upper bound of the portfolio standard deviation, and model the constraint \\( ||\\mathbf{G}^{T}\\mathbf{x}||_{2}\\leq s \\) using the quadratic cone as\n\\[ \\begin{array}{lr} \\text{maximize} \u0026 \\mathbf{\\mu}^{T}\\mathbf{x} - \\tilde{\\delta}s \\\\ \\text{subject to} \u0026 \\left(s, \\mathbf{G}^{T}\\mathbf{x}\\right) \\in \\mathcal{Q}^{k+1} \\\\ \u0026 \\mathbf{1}^{T}\\mathbf{x} = 1 \\label{15} \\end{array} \\]\nSolving the problem in this format will result in a more robust, faster and reliable solution process.\nPython implementation Enough theory for now, let’s code! We’ll be using MOSEK’s Fusion API for solving the optimization problem. MOSEK is an interior-point optimizer for linear, quadratic and conic optimization problems that is employed by several technological, financial and educational institutions. Fusion is an object-oriented API designed for building conic optimization models in a simple and expressive manner.\nIn the Fusion API, the user’s interface to the optimization problem is the Model object. The Model class is used for\nformulating the problem by defining Variables, Parameters, constraints and the objective functions, solving the problem and retrieving the solution status and solutions, interacting with the solver. Let’s define a function for building a Fusion Model that represents the problem from Eq. \\( (\\ref{15})\\). The function will receive the following inputs:\nn_assets: number of assets in the investment universe. asset_sectors: pandas DataFrame containing a column with the assets names (\"Asset\") and another with their corresponding sector (\"Sector\"). constraints: List of constraints. The constraints will be dictionaries containing the following keys: \"Type\": type of constraint. It can be \"All Assets\" (the constraint applies to all the assets), \"Sectors\" (the constraint applies only to assets from a particular sector) or \"Assets\" (the constraint applies to a particular asset). \"Weight\": limit value for the assets’ weights. \"Sign\": domain of the constraint. It can be \"\u003e=\" (greater than) or \"\u003c=\" (less than). \"Position\": indicates to which positions the constraint applies. It can be the name of a sector, the name of an asset or an empty string (\"\") if the constraint type is \"All Assets\". You’ll find examples of asset_sectors and constraints below.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 import mosek.fusion as mf from typing import List, Dict, Any import pandas as pd import numpy as np import altair as alt import yfinance as yf def build_model( n_assets: int, asset_sectors:pd.DataFrame, constraints:List[Dict[str, Any]], )-\u003emf.Model: # Creating the model model = mf.Model(\"markowitz_MV\") # Weights variable with no-short-selling constraint. x = model.variable(\"x\", n_assets, mf.Domain.greaterThan(0.0)) # Variable for modeling the portfolio variance in the objective function s = model.variable(\"s\", 1, mf.Domain.unbounded()) # Parameter for cov matrix decomposition. G = model.parameter(\"G\", [n_assets, n_assets]) # Parameter for expected returns vector. mu = model.parameter(\"mu\", n_assets) # delta parameter delta = model.parameter(\"delta\") # Budget constraint (fully invested) model.constraint(\"budget\", mf.Expr.sum(x), mf.Domain.equalsTo(1)) # Iterate over the constraints list and add the constraints to the model. for c, constraint in enumerate(constraints): sign = ( mf.Domain.greaterThan(constraint[\"Weight\"]) if constraint[\"Sign\"] == \"\u003e=\" else mf.Domain.lessThan(constraint[\"Weight\"]) ) if constraint[\"Type\"] == \"All Assets\": A = np.identity(n_assets) model.constraint( f\"c_{c}\", mf.Expr.mul( A, x ), sign ) elif constraint[\"Type\"] == \"Sectors\": A = np.where( asset_sectors.loc[:, \"Sector\"] == constraint[\"Position\"], 1., 0. ) model.constraint( f\"c_{c}\", mf.Expr.dot(A, x), sign ) elif constraint[\"Type\"] == \"Assets\": A = np.where( asset_sectors.loc[:, \"Assets\"] == constraint[\"Position\"], 1., 0. ) model.constraint( f\"c_{c}\", mf.Expr.dot(A, x), sign ) # Conic constraint for the portfolio variance model.constraint( \"risk\", mf.Expr.vstack( s, mf.Expr.mul(G, x) ), mf.Domain.inQCone() ) # Define objective function model.objective( \"obj\", mf.ObjectiveSense.Maximize, mf.Expr.sub( mf.Expr.dot(mu, x), mf.Expr.mul(delta, s) ) ) return model Let me walk you through the code above:\nLine 15 instantiate the Model object. Lines 18 and 21 create the optimization variables x (portfolio weights) and s (upper bound of the portfolio variance). For creating a variable, we first need to pass the variable’s name, then the dimension (1 for scalars) and lastly, the domain. The domain can be unbounded if there is no restriction; or greaterThan or lessThan if there are lower and upper bounds. Lines 24 and 27 create the parameters for the covariance matrix decomposition G and the expected returns vector mu. We will later set the values of these parameters using real data. Defining both G and mu as parameters is very handy because we can compare different estimation methods without the need of re-building the model. As you can see, parameters are created in a similar way than variables, passing first the name and then the dimension. Line 30 defines the delta parameter for the objective function. We will later try different values for it. Note that delta is a scalar, so we don’t need to pass the dimension in this case. Line 33 set the budget constraint. A constraint is set by passing the name, the mathematical expression and the domain (equality or inequality). Note that the Fusion API has several expressions for performing summation, simple and matrix multiplication, dot product, etc. You can see a complete list in Section 6.3 of MOSEK’s documentation. Lines 36 through 83 set the constraints by asset/s and sector/s. Lines 86 through 93 set the conic constraint for the portfolio variance. Note that G is not transpose here, so we will need to take care of this when setting its value. Lines 96 through 103 define the objective function of the problem. Now, let’s define the investment universe and grab some historical data from Yahoo Finance for estimating the covariance matrix and the vector of expected returns. We will use the yfinance package for downloading the data.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 asset_sectors = pd.DataFrame( { \"Asset\": [ \"NVDA\", \"AMD\", \"INTC\", \"BAC\", \"JPM\", \"C\", \"MSFT\", \"GOOG\", \"META\", \"BTC-USD\", \"ETH-USD\", ], \"Sector\": [ \"Electronic Technology\", \"Electronic Technology\", \"Electronic Technology\", \"Finance\", \"Finance\", \"Finance\", \"Technology Services\", \"Technology Services\", \"Technology Services\", \"Crypto\", \"Crypto\" ] } ) assets_data = yf.download(asset_sectors.loc[:, \"Asset\"].to_list()) For now, we will use the sample estimates for the covariance matrix and expected returns vector. We will see in later posts how we can improve the estimation of these input parameters, which is an important topic because the optimization is highly sensible to them. The covariance matrix decomposition will be computed using the Cholesky’s decomposition.\n1 2 3 4 5 6 7 8 9 10 11 12 13 assets_returns = ( assets_data.loc[:, \"Adj Close\"] .pct_change() .loc[:, asset_sectors.loc[:, \"Asset\"]] ) sigma = assets_returns.cov() mu = assets_returns.mean() G = pd.DataFrame( np.linalg.cholesky(sigma), index=sigma.index, columns=sigma.columns ) We’ll impose the following constraints:\nNo asset will take more than \\(20\\%\\) of the portfolio. We want to invest at least \\(30\\%\\) and no more than \\(40\\%\\) of our wealth in the Electronic Technology sector. We don’t want META to take more than \\(5\\%\\) of the portfolio. We want to invest no more than \\(10\\%\\) in Crypto. The python version of this constraints is as follows:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 constraints = [ {\"Type\": \"All Assets\", \"Weight\": 0.2, \"Sign\": \"\u003c=\", \"Position\": \"\"}, { \"Type\": \"Sectors\", \"Weight\": 0.3, \"Sign\": \"\u003e=\", \"Position\": \"Electronic Technology\", }, { \"Type\": \"Sectors\", \"Weight\": 0.4, \"Sign\": \"\u003c=\", \"Position\": \"Electronic Technology\", }, { \"Type\": \"Assets\", \"Weight\": 0.05, \"Sign\": \"\u003c=\", \"Position\": \"META\", }, { \"Type\": \"Sectors\", \"Weight\": 0.1, \"Sign\": \"\u003c=\", \"Position\": \"Crypto\", }, ] We are now ready to build the model, set the values of the required parameters and solve the optimization problem. We’ll set delta=0.1. For the sake of comparison, we will also solve the unconstrained problem (only considering no short-selling).\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 n_assets = len(asset_sectors) # Build constrained model constrained_model = build_model(n_assets, asset_sectors, constraints) # Set required parameters. constrained_model.getParameter(\"G\").setValue(G.to_numpy().T) # Remember to transpose G. constrained_model.getParameter(\"mu\").setValue(mu.to_numpy()) constrained_model.getParameter(\"delta\").setValue(0.1) # Solve optimization problem. constrained_model.solve() # Get optimal weights from the Model object. weights = pd.Series( constrained_model.getVariable(\"x\").level(), index=asset_sectors.loc[:, \"Asset\"], name=\"Constrained\" ).to_frame() # Build unconstrained model unconstrained_model = build_model(n_assets, asset_sectors, []) # Set required parameters. unconstrained_model.getParameter(\"G\").setValue(G.to_numpy().T) # Remember to transpose G. unconstrained_model.getParameter(\"mu\").setValue(mu.to_numpy()) unconstrained_model.getParameter(\"delta\").setValue(0.1) # Solve optimization problem. unconstrained_model.solve() # Get optimal weights from the Model object. weights.loc[:, \"Unconstrained\"] = unconstrained_model.getVariable(\"x\").level() In the figure below, we can see that the constrained version selected a greater amount of assets and assigned lower weights to them, which helps to improve portfolio diversification.\nAdditionally, we can easily check that all the constraints are met.\nFinally, we can compute the efficient frontier by solving the problem for different values of delta.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 deltas = np.linspace(0.01, 5, 100) efficient_frontier = [] for d in deltas: constrained_model.getParameter(\"delta\").setValue(d) constrained_model.solve() w = constrained_model.getVariable(\"x\").level() portf_exp_return = np.dot(mu, w) * 252 portf_volatility = constrained_model.getVariable(\"s\").level()[0] * np.sqrt(252) efficient_frontier.append([portf_volatility, portf_exp_return, *list(w)]) efficient_frontier = pd.DataFrame( efficient_frontier, columns=[ \"volatility\", \"expected_return\", *asset_sectors.loc[:, \"Asset\"].to_list(), ], ) efficient_frontier.head() Hover your mouse over the plot and zoom-in to see the weights of each portfolio in the frontier.\nConclusion In this post we went through the fundamental concepts of Markowitz Portfolio Optimization and solved the constrained mean-variance optimization problem with the help of MOSEK’s Fusion API. By using real market data, we confirmed that including weight constraints helps to improve portfolio diversification (and thus lowering specific risk). In the next posts, we will solve a different problem: maximize portfolio’s risk-adjusted return measured by the Sharpe Ratio. Additionally, we will perform a backtesting to analyze strategy’s performance. You can find the full code here in the markowitz_mv.ipynb notebook. Stay tuned for more!\n","wordCount":"2974","inLanguage":"en","image":"https://matimacazaga.github.io/img/portfolio_optimization.png","datePublished":"2022-10-10T00:00:00Z","dateModified":"2022-10-10T00:00:00Z","author":{"@type":"Person","name":"Matias Macazaga"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://matimacazaga.github.io/posts/portfolio_optimization/"},"publisher":{"@type":"Organization","name":"MM","logo":{"@type":"ImageObject","url":"https://matimacazaga.github.io/favicon/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://matimacazaga.github.io/ accesskey=h title="MM (Alt + H)">MM</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://matimacazaga.github.io/archives title=Archive><span>Archive</span></a></li><li><a href=https://matimacazaga.github.io/about/ title=About><span>About</span></a></li><li><a href=https://matimacazaga.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://matimacazaga.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://matimacazaga.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://matimacazaga.github.io/posts/>Posts</a></div><h1 class=post-title>Portfolio Optimization with Python - Part I</h1><div class=post-description>Introduction to portfolio optimization using MOSEK's Fusion API.</div><div class=post-meta><span title='2022-10-10 00:00:00 +0000 UTC'>October 10, 2022</span>&nbsp;·&nbsp;14 min&nbsp;·&nbsp;2974 words&nbsp;·&nbsp;Matias Macazaga</div></header><figure class=entry-cover><img loading=lazy src=https://matimacazaga.github.io/img/portfolio_optimization.png alt="Portfolio Optimization"><p><a href="https://www.freepik.com/free-photo/businesspeople-working-finance-accounting-analyze-financi_16068554.htm#query=finance&position=5&from_view=search&track=sph">Source</a></p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#markowitz-portfolio-optimization>Markowitz Portfolio Optimization</a><ul><li><a href=#diversification-constraints>Diversification constraints</a></li><li><a href=#conic-formulation>Conic formulation</a></li></ul></li><li><a href=#python-implementation>Python implementation</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></details></div><div class=post-content><p>This is the first part of the <em>Portfolio Optimization with Python</em> series. The intend is to make a deep dive into the field and study some real-world applications with Python. Throughout the series, I&rsquo;ll be using <a href=https://www.mosek.com/>MOSEK</a> library for solving the optimization problems and <a href=https://www.backtrader.com/>Backtrader</a> for backtesting the portfolio management strategies.</p><p>This time, I&rsquo;ll make a brief introduction to the <a href=https://en.wikipedia.org/wiki/Modern_portfolio_theory>Markowitz Portfolio Optimization</a> framework so you start to familiarize with the relevant concepts. At the end, I&rsquo;ll show you a simple function building the Markowitz Mean-Variance portfolio using MOSEK and finding the optimal weights and efficient frontier.</p><h2 id=markowitz-portfolio-optimization>Markowitz Portfolio Optimization<a hidden class=anchor aria-hidden=true href=#markowitz-portfolio-optimization>#</a></h2><p>Let&rsquo;s consider an investor who wishes to allocate capital among \(N\) securities at time \(t=0\) and hold them over a single period of time \(t=h\). Moreover, assume that the investor is <em>risk-averse</em>, that is, he/she is looking to maximize the return of the investment while trying to keep the investment <em>risk</em> on an acceptable level. We can think of the risk as the <em>uncertainty</em> of the future portfolio returns.</p><p>The investment risk can be decomposed into two components: the <em>specific risk</em> and the <em>systematic risk</em>. We can&rsquo;t do much with the systematic risk part: the only way of reducing it is by decreasing the expected return of the portfolio. On the other hand, the specific risk, or the risk associated with each of the securities in the portfolio, can be reduced through <em>diversification</em> for a fixed expected return. Markowitz Theory (also known as Modern Portfolio Theory) formalizes this process by using the <em>variance</em> as a measure of portfolio risk, and constructing an optimization problem whose solution are the <em>optimal portfolio weights</em> for the given inputs and constraints (more on this later).</p><p>Before I go any further, let me define some important quantities:</p><ul><li>\(p_{0,i}\): the known price of a security \(i\) at the beginning of the investment period.</li><li>\(P_{h,i}\): the random price of the security \(i\) at the end of the investment period \(h\).</li><li>The rate of return of the security \(i\) over the investment period \(h\), modeled by the random variable</li></ul><p>\[R_{i}=\dfrac{P_{h,i}}{p_{0,i}}-1\]</p><ul><li>The expected value of the rate of return of the security \(i\)</li></ul><p>\[ \mu_{i} = \mathbb{E}(R_{i}) \]</p><ul><li>The portfolio vector \(\mathbf{x}\in\mathbb{R}^{N}\), where \(N\) is the number of symbols and \(x_{i}\) is the proportion of funds invested into security \(i\).</li><li>The <em>random</em> portfolio return</li></ul><p>\[R_{\mathbf{x}}=\sum_{i}^{N}x_{i}R_{i}=\mathbf{x}^{T}R,\]</p><p>where \(\mathbf{R}=[R_{1}, \dots, R_{i}, \dots, R_{N}]^{T}\) is the vector of asset&rsquo;s returns.</p><ul><li>The expected portfolio return</li></ul><p>\[\mu_{\mathbf{x}}=\mathbb{E}(R_{\mathbf{x}})=\mathbf{x}^{T}\mathbb{E}(R)=\mathbf{x}^{T}\mathbf{\mu},\]</p><p>where \(\mathbf{\mu}\) is the vector of expected returns.</p><ul><li>The portfolio variance</li></ul><p>\[\sigma_{\mathbf{x}}^{2} = \text{Var}(R_{\mathbf{x}}) = \sum_{i}^{N}\text{Cov}(R_{i}, R_{j})x_{i}x_{j}=\mathbf{x}^{T}\mathbf{\Sigma}\mathbf{x},\]</p><p>where \(\mathbf{\Sigma}\) is the covariance matrix of returns.</p><p>Based on these quantities, we can state the portfolio optimization problem defined above as</p><p>\[\begin{array}{lr}\text{minimize} & \mathbf{x}^{T}\mathbf{\Sigma}\mathbf{x}\\ \text{subject to} & \mathbf{\mu}^{T}\mathbf{x} \geq r_{min} \\ & \mathbf{1}^{T}\mathbf{x} = 1\end{array}\]</p><p>That is, minimize the variance of the portfolio given a minimum required portfolio return \(r_{min}\) and the budget constraint \(\mathbf{1}^{T}\mathbf{x} = \sum_{i}^{N} x_{i} = 1\), which means that the portfolio is fully invested. Given this, the optimization problem is also referred as <em>Mean-Variance Optimization</em> (MVO).</p><p>Using the input parameters \(\mathbf{\mu}\) and \(\mathbf{\Sigma}\), MVO seeks to find a portfolio of assets \(\mathbf{x}\) in such a way that it seeks the optimal trade-off between expected portfolio return and portfolio risk. There are two alternative formulations to the problem statement given above:</p><ul><li>Maximize expected return for a risk level</li></ul><p>\[ \begin{array}{lr} \text{maximize} & \mathbf{\mu}^{T}\mathbf{x} \\ \text{subject to} & \mathbf{x}^{T}\mathbf{\Sigma x}\leq \gamma^{2} \\ & \mathbf{1}^{T}\mathbf{x} = 1,\end{array} \]</p><p>where \(\gamma^{2}\) is an upper bound on the portfolio risk.</p><ul><li>Maximize the utility function of the investor</li></ul><p>\[ \begin{array}{lr} \text{maximize} & \mathbf{\mu}^{T}\mathbf{x} - \dfrac{\delta}{2}\mathbf{x}^{T}\mathbf{\Sigma x} \\ \text{subject to} & \mathbf{1}^{T}\mathbf{x} = 1,\end{array} \]</p><p>where \(\delta\) is the <em>risk-aversion coefficient</em>. The problem with this formulation is that the risk coefficient does not have an intuitive investment meaning for the investor. However, if we reformulate the problem using the standard deviation</p><p>\[ \begin{array}{lr} \text{maximize} & \mathbf{\mu}^{T}\mathbf{x} - \tilde{\delta}\sqrt{\mathbf{x}^{T}\mathbf{\Sigma x}} \\ \text{subject to} & \mathbf{1}^{T}\mathbf{x} = 1,\end{array} \label{9} \]</p><p>and assume that the portfolio return is normally distributed, then \(\tilde{\delta}\) is the z-score of portfolio return, that is, the distance from the mean measured in units of standard deviation. We can see that for \(\tilde{\delta}=0\), we maximize expected portfolio return. Then, by increasing \(\tilde{\delta}\), we put more and more weight on tail risk, i.e., we maximize a lower and lower quantile of portfolio return.</p><p>All the formulations above will result in the same set of optimal solutions. The optimal portfolio \(\mathbf{x}\) is said to be <em>efficient</em> in the sense that there is no other portfolio giving a strictly higher return for the same amount of risk (variance). The collection of such points (portfolios) is known as the <em>efficient frontier</em> in the mean return-variance space.</p><p>We can use the method of Lagrangian multipliers to obtain a closed-form solution for the optimization problem above. However, in the investment practice it is common to include additional constraints in the form of linear and convex equalities or inequalities. Examples of constraints are <em>diversification constraints</em>, <em>leverage constraints</em>, <em>turnover constraints</em>, among others. Furthermore, extra objective function terms can be included for representing restrictions on the optimal weights. In these more realistic use cases, it is compulsory to use numerical optimization algorithms for finding the optimal solution.</p><h3 id=diversification-constraints>Diversification constraints<a hidden class=anchor aria-hidden=true href=#diversification-constraints>#</a></h3><p>We will focus our attention on diversification constraints, which help to limit portfolio risk by restricting the exposure to individual positions or sectors.</p><p>For a single position \(i\), we have</p><p>\[ l_{i} \leq x_{i} \leq u_{i}, \]</p><p>where \(l_{i}\) is the lower bound and \(u_{i}\) the upper one.</p><p>On the other hand, for a sector or group of assets \(\mathcal{I}\), we have</p><p>\[ l_{i} \leq \sum_{i\in\mathcal{I}}x_{i}\leq u_{i} \]</p><p>Note that the constraints of the type <em>greater than</em> (similar for constraints of the type <em>less than</em>) that apply to all the assets can be expressed in matrix form as</p><p>\[ \mathbf{I}^{N\times N} \mathbf{x} \leq \mathbf{1}_{N} u \]</p><p>where \(\mathbf{I}^{N\times N}\) is the identity matrix with \(N\) columns and rows, \(\mathbf{1}_{N}\) is an \(N\)-dimensional vector of ones and \(u\) is the upper bound.</p><p>Additionally, <em>greater than</em> constraints (similar for <em>less than</em> constraints) for assets in a specific sector can be expressed as</p><p>\[ \mathbf{1}_{i\in\mathcal{I}}^{T}\mathbf{x} \leq u \]</p><p>where \(\mathbf{1}_{i\in\mathcal{I}}^{T}\) is an \(N\)-dimensional vector whose values are \(1\) if the asset \(i\) belongs to the sector \(\mathcal{I}\) or \(0\) if not.</p><p>Finally, <em>greater than</em> (or similarly <em>less than</em>) constraints for a specific asset can be expressed as</p><p>\[\mathbf{1}_{i=j}^{T}\mathbf{x} \leq u \]</p><p>where \(\mathbf{1}_{i=j}^{T}\mathbf{x}\) is an \(N\)-dimensional vector whose values are \(1\) only for the asset \(j\) of interest</p><h3 id=conic-formulation>Conic formulation<a hidden class=anchor aria-hidden=true href=#conic-formulation>#</a></h3><p>The portfolio optimization problems stated above are <strong>quadratic optimization (QO)</strong> problems. Solving QO in their original form is popular and considered easy. However, more recent results showed that conic optimization models can improve QO models both in the theoretical and in the practical sense.</p><p>Conic (quadratic) optimization, also known as second-order cone optimization, is a straightforward generalization of linear optimization, meaning that we optimize a linear function under linear (in)equalities with some variables belonging to one or more quadratic cones.</p><p>An \(n\)-dimensional quadratic cone is defined as</p><p>\[ \mathcal{Q}^{n} = \left\{ x \in \mathbb{R}^{n} | x_{1} \geq \sqrt{x_{2}^{2} + x_{3}^{2} + \cdots + x_{n}^{2}} \right\} \]</p><figure><img loading=lazy src=/img/qcone.png alt=Q-Cone><figcaption><p>Example of the geometric interpretation of a quadratic cone and a rotated quadratic cone (not discussed here) with three variables. <a href=https://docs.mosek.com/modeling-cookbook/cqo.html>source</a></p></figcaption></figure><p>Having this in mind and assuming that the covariance matrix \( \mathbf{\Sigma} \) is positive definite such that</p><p>\[ \mathbf{\Sigma} = \mathbf{G}\mathbf{G}^{T}, \ \ \ \mathbf{G}\in\mathbb{R}^{N\times k}\]</p><p>we can write the portfolio variance as</p><p>\[ \mathbf{x}^{T}\mathbf{\Sigma x} = \mathbf{x}^{T}\mathbf{G}\mathbf{G}^{T}x = ||\mathbf{G}^{T}\mathbf{x}||_{2}^{2}. \]</p><p>We can find the conic equivalent of the problem in Eq. \( (\ref{9})\) by introducing a variable \(s\) to represent the upper bound of the portfolio standard deviation, and model the constraint \( ||\mathbf{G}^{T}\mathbf{x}||_{2}\leq s \) using the quadratic cone as</p><p>\[ \begin{array}{lr} \text{maximize} & \mathbf{\mu}^{T}\mathbf{x} - \tilde{\delta}s \\ \text{subject to} & \left(s, \mathbf{G}^{T}\mathbf{x}\right) \in \mathcal{Q}^{k+1} \\ & \mathbf{1}^{T}\mathbf{x} = 1 \label{15} \end{array} \]</p><p>Solving the problem in this format will result in a more robust, faster and reliable solution process.</p><h2 id=python-implementation>Python implementation<a hidden class=anchor aria-hidden=true href=#python-implementation>#</a></h2><p>Enough theory for now, let&rsquo;s code! We&rsquo;ll be using <a href=https://docs.mosek.com/latest/pythonfusion/intro_info.html>MOSEK&rsquo;s Fusion API</a> for solving the optimization problem. MOSEK is an interior-point optimizer for linear, quadratic and conic optimization problems that is employed by several technological, financial and educational institutions. Fusion is an object-oriented API designed for building conic optimization models in a simple and expressive manner.</p><p>In the Fusion API, the user&rsquo;s interface to the optimization problem is the <code>Model</code> object. The <code>Model</code> class is used for</p><ul><li>formulating the problem by defining <code>Variables</code>, <code>Parameters</code>, constraints and the objective functions,</li><li>solving the problem and retrieving the solution status and solutions,</li><li>interacting with the solver.</li></ul><p>Let&rsquo;s define a function for building a Fusion <code>Model</code> that represents the problem from Eq. \( (\ref{15})\). The function will receive the following inputs:</p><ul><li><code>n_assets</code>: number of assets in the investment universe.</li><li><code>asset_sectors</code>: pandas <code>DataFrame</code> containing a column with the assets names (<code>"Asset"</code>) and another with their corresponding sector (<code>"Sector"</code>).</li><li><code>constraints</code>: List of constraints. The constraints will be dictionaries containing the following keys:<ul><li><code>"Type"</code>: type of constraint. It can be <code>"All Assets"</code> (the constraint applies to all the assets), <code>"Sectors"</code> (the constraint applies only to assets from a particular sector) or <code>"Assets"</code> (the constraint applies to a particular asset).</li><li><code>"Weight"</code>: limit value for the assets&rsquo; weights.</li><li><code>"Sign"</code>: domain of the constraint. It can be <code>">="</code> (greater than) or <code>"&lt;="</code> (less than).</li><li><code>"Position"</code>: indicates to which positions the constraint applies. It can be the name of a sector, the name of an asset or an empty string (<code>""</code>) if the constraint type is <code>"All Assets"</code>.</li></ul></li></ul><p>You&rsquo;ll find examples of <code>asset_sectors</code> and <code>constraints</code> below.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>mosek.fusion</span> <span class=k>as</span> <span class=nn>mf</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>altair</span> <span class=k>as</span> <span class=nn>alt</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>yfinance</span> <span class=k>as</span> <span class=nn>yf</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>build_model</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>n_assets</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>asset_sectors</span><span class=p>:</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>constraints</span><span class=p>:</span><span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]],</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>-&gt;</span><span class=n>mf</span><span class=o>.</span><span class=n>Model</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Creating the model</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span> <span class=o>=</span> <span class=n>mf</span><span class=o>.</span><span class=n>Model</span><span class=p>(</span><span class=s2>&#34;markowitz_MV&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Weights variable with no-short-selling constraint.</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>variable</span><span class=p>(</span><span class=s2>&#34;x&#34;</span><span class=p>,</span> <span class=n>n_assets</span><span class=p>,</span> <span class=n>mf</span><span class=o>.</span><span class=n>Domain</span><span class=o>.</span><span class=n>greaterThan</span><span class=p>(</span><span class=mf>0.0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Variable for modeling the portfolio variance in the objective function</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>variable</span><span class=p>(</span><span class=s2>&#34;s&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>mf</span><span class=o>.</span><span class=n>Domain</span><span class=o>.</span><span class=n>unbounded</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Parameter for cov matrix decomposition.</span>
</span></span><span class=line><span class=cl>    <span class=n>G</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>parameter</span><span class=p>(</span><span class=s2>&#34;G&#34;</span><span class=p>,</span> <span class=p>[</span><span class=n>n_assets</span><span class=p>,</span> <span class=n>n_assets</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Parameter for expected returns vector.</span>
</span></span><span class=line><span class=cl>    <span class=n>mu</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>parameter</span><span class=p>(</span><span class=s2>&#34;mu&#34;</span><span class=p>,</span> <span class=n>n_assets</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># delta parameter</span>
</span></span><span class=line><span class=cl>    <span class=n>delta</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>parameter</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Budget constraint (fully invested)</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span><span class=o>.</span><span class=n>constraint</span><span class=p>(</span><span class=s2>&#34;budget&#34;</span><span class=p>,</span> <span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>x</span><span class=p>),</span> <span class=n>mf</span><span class=o>.</span><span class=n>Domain</span><span class=o>.</span><span class=n>equalsTo</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Iterate over the constraints list and add the constraints to the model.</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>c</span><span class=p>,</span> <span class=n>constraint</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>constraints</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>sign</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>mf</span><span class=o>.</span><span class=n>Domain</span><span class=o>.</span><span class=n>greaterThan</span><span class=p>(</span><span class=n>constraint</span><span class=p>[</span><span class=s2>&#34;Weight&#34;</span><span class=p>])</span> 
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>constraint</span><span class=p>[</span><span class=s2>&#34;Sign&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;&gt;=&#34;</span> <span class=k>else</span> 
</span></span><span class=line><span class=cl>            <span class=n>mf</span><span class=o>.</span><span class=n>Domain</span><span class=o>.</span><span class=n>lessThan</span><span class=p>(</span><span class=n>constraint</span><span class=p>[</span><span class=s2>&#34;Weight&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>constraint</span><span class=p>[</span><span class=s2>&#34;Type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;All Assets&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>A</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>identity</span><span class=p>(</span><span class=n>n_assets</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>model</span><span class=o>.</span><span class=n>constraint</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=sa>f</span><span class=s2>&#34;c_</span><span class=si>{</span><span class=n>c</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>mul</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>A</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>x</span>
</span></span><span class=line><span class=cl>                <span class=p>),</span> 
</span></span><span class=line><span class=cl>                <span class=n>sign</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>constraint</span><span class=p>[</span><span class=s2>&#34;Type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;Sectors&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>A</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>asset_sectors</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=s2>&#34;Sector&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=n>constraint</span><span class=p>[</span><span class=s2>&#34;Position&#34;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>                <span class=mf>1.</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=mf>0.</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>model</span><span class=o>.</span><span class=n>constraint</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=sa>f</span><span class=s2>&#34;c_</span><span class=si>{</span><span class=n>c</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>A</span><span class=p>,</span> <span class=n>x</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=n>sign</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>constraint</span><span class=p>[</span><span class=s2>&#34;Type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;Assets&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>A</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>asset_sectors</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=s2>&#34;Assets&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=n>constraint</span><span class=p>[</span><span class=s2>&#34;Position&#34;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>                <span class=mf>1.</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=mf>0.</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>model</span><span class=o>.</span><span class=n>constraint</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=sa>f</span><span class=s2>&#34;c_</span><span class=si>{</span><span class=n>c</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>A</span><span class=p>,</span> <span class=n>x</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=n>sign</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=c1># Conic constraint for the portfolio variance</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span><span class=o>.</span><span class=n>constraint</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;risk&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>vstack</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>mul</span><span class=p>(</span><span class=n>G</span><span class=p>,</span> <span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span> 
</span></span><span class=line><span class=cl>        <span class=n>mf</span><span class=o>.</span><span class=n>Domain</span><span class=o>.</span><span class=n>inQCone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Define objective function</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span><span class=o>.</span><span class=n>objective</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;obj&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>mf</span><span class=o>.</span><span class=n>ObjectiveSense</span><span class=o>.</span><span class=n>Maximize</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>mu</span><span class=p>,</span> <span class=n>x</span><span class=p>),</span> 
</span></span><span class=line><span class=cl>            <span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>mul</span><span class=p>(</span><span class=n>delta</span><span class=p>,</span> <span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>model</span>
</span></span></code></pre></td></tr></table></div></div><p>Let me walk you through the code above:</p><ul><li>Line 15 instantiate the <code>Model</code> object.</li><li>Lines 18 and 21 create the optimization variables <code>x</code> (portfolio weights) and <code>s</code> (upper bound of the portfolio variance). For creating a variable, we first need to pass the variable&rsquo;s name, then the dimension (<code>1</code> for scalars) and lastly, the domain. The domain can be <code>unbounded</code> if there is no restriction; or <code>greaterThan</code> or <code>lessThan</code> if there are lower and upper bounds.</li><li>Lines 24 and 27 create the parameters for the covariance matrix decomposition <code>G</code> and the expected returns vector <code>mu</code>. We will later set the values of these parameters using real data. Defining both <code>G</code> and <code>mu</code> as parameters is very handy because we can compare different estimation methods without the need of re-building the model. As you can see, parameters are created in a similar way than variables, passing first the name and then the dimension.</li><li>Line 30 defines the <code>delta</code> parameter for the objective function. We will later try different values for it. Note that <code>delta</code> is a scalar, so we don&rsquo;t need to pass the dimension in this case.</li><li>Line 33 set the budget constraint. A constraint is set by passing the name, the mathematical expression and the domain (equality or inequality). Note that the Fusion API has several expressions for performing summation, simple and matrix multiplication, dot product, etc. You can see a complete list in <a href=https://docs.mosek.com/latest/pythonfusion/modeling.html#expressions-and-linear-operators>Section 6.3</a> of MOSEK&rsquo;s documentation.</li><li>Lines 36 through 83 set the constraints by asset/s and sector/s.</li><li>Lines 86 through 93 set the conic constraint for the portfolio variance. Note that <code>G</code> is not transpose here, so we will need to take care of this when setting its value.</li><li>Lines 96 through 103 define the objective function of the problem.</li></ul><p>Now, let&rsquo;s define the investment universe and grab some historical data from Yahoo Finance for estimating the covariance matrix and the vector of expected returns. We will use the <a href=https://pypi.org/project/yfinance/><code>yfinance</code></a> package for downloading the data.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>asset_sectors</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Asset&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;NVDA&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=s2>&#34;AMD&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=s2>&#34;INTC&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=s2>&#34;BAC&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;JPM&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;C&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;MSFT&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;GOOG&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;META&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;BTC-USD&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;ETH-USD&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Sector&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Electronic Technology&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Electronic Technology&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Electronic Technology&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Finance&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Finance&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Finance&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Technology Services&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Technology Services&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Technology Services&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Crypto&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Crypto&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>assets_data</span> <span class=o>=</span> <span class=n>yf</span><span class=o>.</span><span class=n>download</span><span class=p>(</span><span class=n>asset_sectors</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=s2>&#34;Asset&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>to_list</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><p>For now, we will use the sample estimates for the covariance matrix and expected returns vector. We will see in later posts how we can improve the estimation of these input parameters, which is an important topic because the optimization is highly sensible to them. The covariance matrix decomposition will be computed using the Cholesky&rsquo;s decomposition.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>assets_returns</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>assets_data</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=s2>&#34;Adj Close&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>pct_change</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=n>asset_sectors</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=s2>&#34;Asset&#34;</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sigma</span> <span class=o>=</span> <span class=n>assets_returns</span><span class=o>.</span><span class=n>cov</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>mu</span> <span class=o>=</span> <span class=n>assets_returns</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>G</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>cholesky</span><span class=p>(</span><span class=n>sigma</span><span class=p>),</span> <span class=n>index</span><span class=o>=</span><span class=n>sigma</span><span class=o>.</span><span class=n>index</span><span class=p>,</span> <span class=n>columns</span><span class=o>=</span><span class=n>sigma</span><span class=o>.</span><span class=n>columns</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>We&rsquo;ll impose the following constraints:</p><ul><li>No asset will take more than \(20\%\) of the portfolio.</li><li>We want to invest at least \(30\%\) and no more than \(40\%\) of our wealth in the Electronic Technology sector.</li><li>We don&rsquo;t want META to take more than \(5\%\) of the portfolio.</li><li>We want to invest no more than \(10\%\) in Crypto.</li></ul><p>The python version of this constraints is as follows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>constraints</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=s2>&#34;Type&#34;</span><span class=p>:</span> <span class=s2>&#34;All Assets&#34;</span><span class=p>,</span> <span class=s2>&#34;Weight&#34;</span><span class=p>:</span> <span class=mf>0.2</span><span class=p>,</span> <span class=s2>&#34;Sign&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;=&#34;</span><span class=p>,</span> <span class=s2>&#34;Position&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Type&#34;</span><span class=p>:</span> <span class=s2>&#34;Sectors&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Weight&#34;</span><span class=p>:</span> <span class=mf>0.3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Sign&#34;</span><span class=p>:</span> <span class=s2>&#34;&gt;=&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Position&#34;</span><span class=p>:</span> <span class=s2>&#34;Electronic Technology&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Type&#34;</span><span class=p>:</span> <span class=s2>&#34;Sectors&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Weight&#34;</span><span class=p>:</span> <span class=mf>0.4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Sign&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;=&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Position&#34;</span><span class=p>:</span> <span class=s2>&#34;Electronic Technology&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Type&#34;</span><span class=p>:</span> <span class=s2>&#34;Assets&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Weight&#34;</span><span class=p>:</span> <span class=mf>0.05</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Sign&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;=&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Position&#34;</span><span class=p>:</span> <span class=s2>&#34;META&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Type&#34;</span><span class=p>:</span> <span class=s2>&#34;Sectors&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Weight&#34;</span><span class=p>:</span> <span class=mf>0.1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Sign&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;=&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Position&#34;</span><span class=p>:</span> <span class=s2>&#34;Crypto&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>We are now ready to build the model, set the values of the required parameters and solve the optimization problem. We&rsquo;ll set <code>delta=0.1</code>. For the sake of comparison, we will also solve the unconstrained problem (only considering no short-selling).</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>n_assets</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>asset_sectors</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Build constrained model</span>
</span></span><span class=line><span class=cl><span class=n>constrained_model</span> <span class=o>=</span> <span class=n>build_model</span><span class=p>(</span><span class=n>n_assets</span><span class=p>,</span> <span class=n>asset_sectors</span><span class=p>,</span> <span class=n>constraints</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Set required parameters.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>constrained_model</span><span class=o>.</span><span class=n>getParameter</span><span class=p>(</span><span class=s2>&#34;G&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>setValue</span><span class=p>(</span><span class=n>G</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>()</span><span class=o>.</span><span class=n>T</span><span class=p>)</span> <span class=c1># Remember to transpose G.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>constrained_model</span><span class=o>.</span><span class=n>getParameter</span><span class=p>(</span><span class=s2>&#34;mu&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>setValue</span><span class=p>(</span><span class=n>mu</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>constrained_model</span><span class=o>.</span><span class=n>getParameter</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>setValue</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Solve optimization problem.</span>
</span></span><span class=line><span class=cl><span class=n>constrained_model</span><span class=o>.</span><span class=n>solve</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Get optimal weights from the Model object.</span>
</span></span><span class=line><span class=cl><span class=n>weights</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>constrained_model</span><span class=o>.</span><span class=n>getVariable</span><span class=p>(</span><span class=s2>&#34;x&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>level</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=n>index</span><span class=o>=</span><span class=n>asset_sectors</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=s2>&#34;Asset&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=o>=</span><span class=s2>&#34;Constrained&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>.</span><span class=n>to_frame</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Build unconstrained model</span>
</span></span><span class=line><span class=cl><span class=n>unconstrained_model</span> <span class=o>=</span> <span class=n>build_model</span><span class=p>(</span><span class=n>n_assets</span><span class=p>,</span> <span class=n>asset_sectors</span><span class=p>,</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Set required parameters.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>unconstrained_model</span><span class=o>.</span><span class=n>getParameter</span><span class=p>(</span><span class=s2>&#34;G&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>setValue</span><span class=p>(</span><span class=n>G</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>()</span><span class=o>.</span><span class=n>T</span><span class=p>)</span> <span class=c1># Remember to transpose G.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>unconstrained_model</span><span class=o>.</span><span class=n>getParameter</span><span class=p>(</span><span class=s2>&#34;mu&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>setValue</span><span class=p>(</span><span class=n>mu</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>unconstrained_model</span><span class=o>.</span><span class=n>getParameter</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>setValue</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Solve optimization problem.</span>
</span></span><span class=line><span class=cl><span class=n>unconstrained_model</span><span class=o>.</span><span class=n>solve</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Get optimal weights from the Model object.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>weights</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=s2>&#34;Unconstrained&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>unconstrained_model</span><span class=o>.</span><span class=n>getVariable</span><span class=p>(</span><span class=s2>&#34;x&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>level</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>In the figure below, we can see that the constrained version selected a greater amount of assets and assigned lower weights to them, which helps to improve portfolio diversification.</p><iframe src=/altair_plots/weights_comparison.html width=600px height=420px></iframe><p>Additionally, we can easily check that all the constraints are met.</p><p>Finally, we can compute the efficient frontier by solving the problem for different values of <code>delta</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>deltas</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linspace</span><span class=p>(</span><span class=mf>0.01</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>efficient_frontier</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>d</span> <span class=ow>in</span> <span class=n>deltas</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>constrained_model</span><span class=o>.</span><span class=n>getParameter</span><span class=p>(</span><span class=s2>&#34;delta&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>setValue</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>constrained_model</span><span class=o>.</span><span class=n>solve</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>w</span> <span class=o>=</span> <span class=n>constrained_model</span><span class=o>.</span><span class=n>getVariable</span><span class=p>(</span><span class=s2>&#34;x&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>level</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>portf_exp_return</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>mu</span><span class=p>,</span> <span class=n>w</span><span class=p>)</span> <span class=o>*</span> <span class=mi>252</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>portf_volatility</span> <span class=o>=</span> <span class=n>constrained_model</span><span class=o>.</span><span class=n>getVariable</span><span class=p>(</span><span class=s2>&#34;s&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>level</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=mi>252</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>efficient_frontier</span><span class=o>.</span><span class=n>append</span><span class=p>([</span><span class=n>portf_volatility</span><span class=p>,</span> <span class=n>portf_exp_return</span><span class=p>,</span> <span class=o>*</span><span class=nb>list</span><span class=p>(</span><span class=n>w</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>efficient_frontier</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>efficient_frontier</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>columns</span><span class=o>=</span><span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;volatility&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;expected_return&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>asset_sectors</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=s2>&#34;Asset&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>to_list</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>efficient_frontier</span><span class=o>.</span><span class=n>head</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>Hover your mouse over the plot and zoom-in to see the weights of each portfolio in the frontier.</p><iframe src=/altair_plots/efficient_frontier.html width=470px height=360px></iframe><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>In this post we went through the fundamental concepts of Markowitz Portfolio Optimization and solved the constrained mean-variance optimization problem with the help of MOSEK&rsquo;s Fusion API. By using real market data, we confirmed that including weight constraints helps to improve portfolio diversification (and thus lowering specific risk). In the next posts, we will solve a different problem: maximize portfolio&rsquo;s risk-adjusted return measured by the Sharpe Ratio. Additionally, we will perform a backtesting to analyze strategy&rsquo;s performance. You can find the full code <a href=https://github.com/matimacazaga/portfolio_optimization_with_mosek>here</a> in the <code>markowitz_mv.ipynb</code> notebook. Stay tuned for more!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://matimacazaga.github.io/tags/mosek/>MOSEK</a></li><li><a href=https://matimacazaga.github.io/tags/python/>Python</a></li><li><a href=https://matimacazaga.github.io/tags/portfolio-optimization/>Portfolio Optimization</a></li><li><a href=https://matimacazaga.github.io/tags/efficient-frontier/>Efficient Frontier</a></li><li><a href=https://matimacazaga.github.io/tags/backtesting/>Backtesting</a></li><li><a href=https://matimacazaga.github.io/tags/backtrader/>Backtrader</a></li></ul><nav class=paginav><a class=next href=https://matimacazaga.github.io/posts/hugo_tutorial/><span class=title>Next »</span><br><span>Start a blog using Hugo and Github Pages</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Portfolio Optimization with Python - Part I on twitter" href="https://twitter.com/intent/tweet/?text=Portfolio%20Optimization%20with%20Python%20-%20Part%20I&url=https%3a%2f%2fmatimacazaga.github.io%2fposts%2fportfolio_optimization%2f&hashtags=MOSEK%2cPython%2cPortfolioOptimization%2cEfficientFrontier%2cBacktesting%2cBacktrader"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Portfolio Optimization with Python - Part I on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fmatimacazaga.github.io%2fposts%2fportfolio_optimization%2f&title=Portfolio%20Optimization%20with%20Python%20-%20Part%20I&summary=Portfolio%20Optimization%20with%20Python%20-%20Part%20I&source=https%3a%2f%2fmatimacazaga.github.io%2fposts%2fportfolio_optimization%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Portfolio Optimization with Python - Part I on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fmatimacazaga.github.io%2fposts%2fportfolio_optimization%2f&title=Portfolio%20Optimization%20with%20Python%20-%20Part%20I"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Portfolio Optimization with Python - Part I on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fmatimacazaga.github.io%2fposts%2fportfolio_optimization%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Portfolio Optimization with Python - Part I on whatsapp" href="https://api.whatsapp.com/send?text=Portfolio%20Optimization%20with%20Python%20-%20Part%20I%20-%20https%3a%2f%2fmatimacazaga.github.io%2fposts%2fportfolio_optimization%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Portfolio Optimization with Python - Part I on telegram" href="https://telegram.me/share/url?text=Portfolio%20Optimization%20with%20Python%20-%20Part%20I&url=https%3a%2f%2fmatimacazaga.github.io%2fposts%2fportfolio_optimization%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://matimacazaga.github.io/>MM</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script type=text/x-mathjax-config> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "all" } } }); </script><script type=text/javascript src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>