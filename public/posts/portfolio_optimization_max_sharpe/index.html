<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Portfolio Optimization with Python - Part II | MM</title><meta name=keywords content="MOSEK,Python,Portfolio Optimization,Efficient Frontier,Sharpe Ratio"><meta name=description content="Max Sharpe portfolio optimization using MOSEK's Fusion API."><meta name=author content="Matias Macazaga"><link rel=canonical href=https://matimacazaga.github.io/posts/portfolio_optimization_max_sharpe/><link crossorigin=anonymous href=/assets/css/stylesheet.6f3393efeb1932ac5e626c481ab86d6698c5984b7efc1e55c5a8e51fb4958e8b.css integrity="sha256-bzOT7+sZMqxeYmxIGrhtZpjFmEt+/B5VxajlH7SVjos=" rel="preload stylesheet" as=style><link rel=icon href=https://matimacazaga.github.io/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://matimacazaga.github.io/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://matimacazaga.github.io/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://matimacazaga.github.io/favicon/apple-touch-icon.png><link rel=mask-icon href=https://matimacazaga.github.io/favicon/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Portfolio Optimization with Python - Part II"><meta property="og:description" content="Max Sharpe portfolio optimization using MOSEK's Fusion API."><meta property="og:type" content="article"><meta property="og:url" content="https://matimacazaga.github.io/posts/portfolio_optimization_max_sharpe/"><meta property="og:image" content="https://matimacazaga.github.io/img/portfolio_optimization_2.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-05T00:00:00+00:00"><meta property="article:modified_time" content="2023-07-05T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://matimacazaga.github.io/img/portfolio_optimization_2.png"><meta name=twitter:title content="Portfolio Optimization with Python - Part II"><meta name=twitter:description content="Max Sharpe portfolio optimization using MOSEK's Fusion API."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://matimacazaga.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Portfolio Optimization with Python - Part II","item":"https://matimacazaga.github.io/posts/portfolio_optimization_max_sharpe/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Portfolio Optimization with Python - Part II","name":"Portfolio Optimization with Python - Part II","description":"Max Sharpe portfolio optimization using MOSEK's Fusion API.","keywords":["MOSEK","Python","Portfolio Optimization","Efficient Frontier","Sharpe Ratio"],"articleBody":"This is the second part of the Portfolio Optimization with Python series. In Part I, we introduced the Portfolio Optimization field, the MVO framework and the MOSEK python API for solving a constrained portfolio optimization problem efficiently. This time, we will find the portfolio that maximizes a performance metric called Sharpe Ratio. We will first introduce the Sharpe Ratio and its benefits and drawbacks as a portfolio performance metric. Finally, we will formulate the optimization problem theoretically as a conic problem and solve it using Python.\nSharpe Ratio Developed by Nobel laureate William F. Sharpe in 1966, the Sharpe Ratio serves as a cornerstone for portfolio evaluation and comparison. This metric enables investors to assess the risk-adjusted return of a portfolio, providing a comprehensive measure of its efficiency. By incorporating both the returns and volatility of a portfolio, the Sharpe Ratio assists investors in making informed decisions, aiming to maximize returns while minimizing risk.\nThe Sharpe Ratio is defined as the ratio of the excess return of an investment over the risk-free rate to the standard deviation of the investment’s returns. Mathematically, the formula is expressed as:\n\\[ SR = \\dfrac{R_{p} - R_{f}}{\\sigma_{p}}, \\]\nwhere:\n\\(SR\\) is the Sharpe Ratio. \\(R_{p}\\) denotes the portfolio’s expected return. \\(R_{f}\\) signifies the risk-free rate of return. \\(\\sigma_{p}\\) represents the standard deviation of the portfolio’s returns. We can rewrite this formula in terms of the portfolio weights \\(\\mathbf{x}\\), the expected return vector \\(\\mathbf{\\mu}\\) and the covariance matrix \\(\\Sigma\\) as follows:\n\\[SR = \\dfrac{\\mathbf{\\mu}^{T}\\mathbf{x} - r_{f}}{\\sqrt{\\mathbf{x}^{T}\\Sigma \\mathbf{x}}}\\]\nBenefits The benefits of using the Sharpe Ratio are:\nRisk-adjusted Performance: the Sharpe Ratio provides a more comprehensive assessment of portfolio performance. It accounts for the inherent risk associated with investments and helps investors evaluate the potential rewards relative to the level of risk undertaken. Comparative Analysis: the Sharpe Ratio allows for straightforward comparisons between different investment portfolios by assessing their risk-adjusted returns. Decision Support: this metric aids in decision-making by quantifying the trade-off between returns and risk. An investor can utilize the Sharpe Ratio to identify portfolios with higher expected returns per unit of risk. Drawbacks Assumptions of Normality: the Sharpe Ratio assumes that returns follow a normal distribution, which might not always be the case in real-world scenarios. Sensitivity to Risk-Free Rate: The choice of an appropriate risk-free rate can significantly impact the Sharpe Ratio. The risk-free rate acts as a benchmark, representing the return an investor would earn from a riskless investment. However, different market conditions and varying interpretations of the risk-free rate can introduce subjectivity and affect the interpretation of the Sharpe Ratio. Dependency on Historical Data: the Sharpe Ratio relies on historical data to estimate the average returns and standard deviation of a portfolio. Consequently, it assumes that past performance is indicative of future outcomes. While it may not be possible to completely eliminate the drawbacks of the Sharpe Ratio, several approaches can help to mitigate their impact and enhance metric’s effectiveness. Although we will not focus on these approaches, here are some strategies to address the drawbacks mentioned above:\nUse other risk-adjusted metrics that are more suitable for modeling non-normal return distributions, such as the Sortino Ratio or the Omega Ratio, which account for downside risk and skweness in return distributions. Incorporate Stress Testing and Scenario Analysis to account for extreme market events and analyze portfolio performance in adverse market conditions. This approach can help to refine the risk management strategies. Use Robust Portfolio Optimization techniques to incorporate uncertainty by considering a range of potential scenarios, minimizing the impact of extreme events and improving the reliability of risk and return estimates. Conic Formulation The idea now is to use the Sharpe Ratio metric as the objective function in our optimization problem. In this way, the objective function of the portfolio optimization algorithm is\n\\[\\text{maximize}_{\\mathbf{x}} \\dfrac{\\mathbf{\\mu}^{T}\\mathbf{x} - r_f }{||\\mathbf{G}^{T}\\mathbf{x}||_2}, \\]\nwhere we reformulated the risk term as a 2-norm as in the previous post.\nIn order to derive a conic formulation for the objective function above, we should not that if we could fix the term in the numerator\n\\[ \\mathbf{\\mu}^{T}\\mathbf{x} - r_{f} = \\text{const}, \\]\nthen the objective would be equivalent to minimizing \\(||\\mathbf{G}^{T}\\mathbf{x}||_2\\), which is a standard second-order cone problem.\nWe do not know in advance what the constant value should be. Solving this problem for all the possible constant values is equivalent to computing the efficient frontier. We do not want to do that, therefore let’s denote the constant value using a new scalar variable \\(z\\), \\(z\\geq 0\\), as \\(\\text{const}=1/z\\). In this way, we now have\n\\[ \\mathbf{\\mu}^{T}\\mathbf{x} - r_{f} = \\dfrac{1}{z} \\]\nThe reason for using \\(1/z\\) will become obvious in a moment. If we multiply both sides by \\(z\\), we obtain\n\\[z \\mathbf{\\mu}^{T}\\mathbf{x} - r_{f}z = 1 \\]\nDenoting \\(\\mathbf{y}=z\\mathbf{x}\\), this equation becomes\n\\[\\mathbf{\\mu}^{T}\\mathbf{y} - r_{f}z = 1 \\]\nGiven that \\(\\mathbf{x} = \\mathbf{y}/z\\), the objective function becomes\n\\[ \\dfrac{\\mathbf{\\mathbf{\\mu}^{T}\\mathbf{x} - r_{f}}}{||\\mathbf{G}^{T}\\mathbf{x}||_2}=\\dfrac{1/z}{||\\mathbf{G}^{T}\\mathbf{\\frac{y}{z}}||_2} = \\dfrac{1}{||\\mathbf{G}^{T}\\mathbf{y}||_2}, \\]\nwhich allows us to rewrite the original optimization problem as\n\\[ \\begin{array}{lr} \\text{minimize} \u0026 ||\\mathbf{G}^{T}\\mathbf{y}||_{2} \\\\ \\text{subject to} \u0026 \\mathbf{\\mu}^{T}\\mathbf{y} - r_f z = 1 \\\\ \u0026 z\\geq 0 \\end{array} \\]\nThe new problem involves variables \\(\\mathbf{y}\\) and \\(z\\), so any additional constraints must be rewritten by substituting \\(x=y/z\\). For instance, the budget constraint \\( \\mathbf{1}^{T}\\mathbf{x} = 1\\) is reformulated as\n\\[ \\mathbf{1}^{T}\\mathbf{y} = z, \\ \\ \\ y\\geq 0. \\]\nOn the other hand, diversification constraints of the form \\(l_{i} \\leq x_{i} \\leq u_{i}\\) are rewritten as\n\\[ zl_{i} \\leq y_{i} \\leq zu_{i} \\]\nFinally, a solution \\(y, z\\) to the reformulated optimization problem gives a solution \\(x=y/z\\) to the original problem.\nPython Implementation The implementation of the portfolio optimization problem in Python closely resembles the approach presented in our previous post. The primary distinction lies in the modification of variables to reframe the problem as a conic optimization problem.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 import mosek.fusion as mf from typing import List, Dict, Any import pandas as pd import numpy as np import yfinance as yf import altair as alt alt.renderers.set_embed_options(actions=False, theme=\"dark\") def build_model( n_assets: int, asset_sectors: pd.DataFrame, constraints: List[Dict[str, Any]], risk_free: float = 0.0, ) -\u003e mf.Model: \"\"\" Function for building MOSEK model to solve the mean-variance optimization problem with diversification constraints. Parameters ---------- n_assets : int Number of assets in the investment universe. asset_sectors : pd.DataFrame DataFrame containing assets' names (`\"Asset\"` column) and their corresponding sectors (`\"Sector\"` column). constraints : List[Dict[str, Any]] List of diversification constraints (dictionaries). The dictionaries must have the following keys: - `\"Type\"`: type of constraint. It can be `\"All Assets\"` (the constraint applies to all the assets), `\"Sectors\"` (the constraint applies only to assets from a particular sector) or `\"Assets\"` (the constraint applies to a particular asset). - `\"Weight\"`: limit value for the assets' weights. - `\"Sign\"`: domain of the constraint. It can be `\"\u003e=\"` (greater than) or `\"\u003c=\"` (less than). - `\"Position\"`: indicates to which positions the constraint applies. It can be the name of a sector, the name of an asset or an empty string (`\"\"`) if the constraint type is `\"All Assets\"`. risk_free: float Risk free rate. Returns ------- model: mf.Model MOSEK model object. \"\"\" # Creating the model model = mf.Model(\"sharpe_ratio\") # Auxiliar vector variable y. y = model.variable(\"y\", n_assets, mf.Domain.greaterThan(0.0)) # Auxiliar scalar variable z. z = model.variable(\"z\", 1, mf.Domain.greaterThan(0.0)) # Variable for modeling the portfolio variance in the objective function s = model.variable(\"s\", 1, mf.Domain.unbounded()) # Parameter for cov matrix decomposition. G = model.parameter(\"G\", [n_assets, n_assets]) # Parameter for expected returns vector. mu = model.parameter(\"mu\", n_assets) # Reformulation constraint model.constraint( \"reformulation\", mf.Expr.sub(mf.Expr.dot(mu, y), mf.Expr.mul(risk_free, z)), mf.Domain.equalsTo(1.0), ) # Budget constraint (fully invested) model.constraint( \"budget\", mf.Expr.sub(mf.Expr.sum(y), z), mf.Domain.equalsTo(0) ) # Iterate over the constraints list and add the constraints to the model. for c, constraint in enumerate(constraints): sign = ( mf.Domain.greaterThan(0.0) if constraint[\"Sign\"] == \"\u003e=\" else mf.Domain.lessThan(0.0) ) if constraint[\"Type\"] == \"All Assets\": A = np.identity(n_assets) model.constraint( f\"c_{c}\", mf.Expr.sub( mf.Expr.mul(A, y), mf.Expr.mul( constraint[\"Weight\"], mf.Var.vrepeat(z, n_assets) ), ), sign, ) elif constraint[\"Type\"] == \"Sectors\": A = np.where( asset_sectors.loc[:, \"Sector\"] == constraint[\"Position\"], 1.0, 0.0, ) model.constraint( f\"c_{c}\", mf.Expr.sub( mf.Expr.dot(A, y), mf.Expr.mul( constraint[\"Weight\"], z ), ), sign, ) elif constraint[\"Type\"] == \"Assets\": A = np.where( asset_sectors.loc[:, \"Asset\"] == constraint[\"Position\"], 1.0, 0.0, ) model.constraint( f\"c_{c}\", mf.Expr.sub( mf.Expr.dot(A, y), mf.Expr.mul( constraint[\"Weight\"], z ), ), sign, ) # Conic constraint for the portfolio variance model.constraint( \"risk\", mf.Expr.vstack(s, mf.Expr.mul(G, y)), mf.Domain.inQCone() ) # Define objective function model.objective( \"obj\", mf.ObjectiveSense.Minimize, s, ) return model We will employ the identical investment universe and constraints as outlined in the previous post. Our objective is to obtain the vector variable \\(\\mathbf{y}\\) and the scalar variable \\(z\\), which will be utilized to derive the optimal portfolio weights by calculating their ratio.\n1 2 3 4 5 6 7 8 9 10 11 12 # Get optimal weights from the Model object. weights = pd.Series( constrained_model.getVariable(\"y\").level() / constrained_model.getVariable(\"z\").level()[0], index=asset_sectors.loc[:, \"Asset\"], name=\"Constrained\", ).to_frame() weights.loc[:, \"Unconstrained\"] = ( unconstrained_model.getVariable(\"y\").level() / unconstrained_model.getVariable(\"z\").level()[0] ) The plot below illustrates the portfolio weights for both the constrained and unconstrained cases. Once again, we observe that the imposition of constraints leads to the selection of a greater number of assets.\nWe can utilize the following function to calculate the Sharpe Ratio of the portfolios and assess the influence of the constraints on its value.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 def get_portfolio_sharpe_ratio( weights: np.ndarray | pd.Series, mu: np.ndarray | pd.Series, sigma: np.ndarray | pd.DataFrame, ann_factor: int = 252, ): \"\"\" Computes the Annualized Sharpe Ratio. Parameters ---------- weights : np.ndarray | pd.Series Portfolio weights. mu : np.ndarray | pd.Series Expected return. sigma : np.ndarray | pd.DataFrame Covariance matrix. ann_factor : int, optional Annualization factor, by default 252. Returns ------- float Sharpe Ratio. \"\"\" std_dev = np.sqrt( np.dot( np.dot( weights, sigma, ), weights, ) ) expected_return = np.dot( weights, mu, ) return (expected_return/std_dev)*np.sqrt(ann_factor) The constrained portfolio exhibits a Sharpe Ratio of 0.95, whereas the unconstrained version achieves a ratio of 1.10. It is important to note that these calculations rely on historical data, and future portfolio performance may deviate from these values. While the constrained portfolio’s Sharpe Ratio is lower than that of the unconstrained version, it is possible that the constraints have positively impacted other significant risk metrics. To further analyze this, a backtest will be performed, as detailed in the upcoming post.\nConclusion We have explored the use of the Sharpe Ratio in portfolio optimization and management, highlighting its benefits and limitations. The Sharpe Ratio provides a valuable metric for evaluating risk-adjusted returns and aiding investment decision-making. While it offers insights into portfolio efficiency, it is crucial to consider its assumptions and potential drawbacks.\nTo further deepen our analysis and gain a comprehensive understanding of the impact of constraints on portfolio performance, the next post will delve into the execution of a backtest. Using Python’s bt library, we will demonstrate how to conduct a thorough evaluation by simulating the historical performance of constrained and unconstrained portfolios. This will enable us to assess their risk-return trade-offs and gain valuable insights into the efficacy of the portfolio optimization strategies employed.\nYou can find the full code here in the sharpe_ratio.ipynb notebook.\nStay tuned for the next post, where we will explore the intricacies of backtesting and how it can enhance our understanding of portfolio performance in real-world scenarios.\n","wordCount":"2044","inLanguage":"en","image":"https://matimacazaga.github.io/img/portfolio_optimization_2.png","datePublished":"2023-07-05T00:00:00Z","dateModified":"2023-07-05T00:00:00Z","author":{"@type":"Person","name":"Matias Macazaga"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://matimacazaga.github.io/posts/portfolio_optimization_max_sharpe/"},"publisher":{"@type":"Organization","name":"MM","logo":{"@type":"ImageObject","url":"https://matimacazaga.github.io/favicon/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://matimacazaga.github.io/ accesskey=h title="MM (Alt + H)">MM</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://matimacazaga.github.io/archives title=Archive><span>Archive</span></a></li><li><a href=https://matimacazaga.github.io/about/ title=About><span>About</span></a></li><li><a href=https://matimacazaga.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://matimacazaga.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://matimacazaga.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://matimacazaga.github.io/posts/>Posts</a></div><h1 class=post-title>Portfolio Optimization with Python - Part II</h1><div class=post-description>Max Sharpe portfolio optimization using MOSEK's Fusion API.</div><div class=post-meta><span title='2023-07-05 00:00:00 +0000 UTC'>July 5, 2023</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;2044 words&nbsp;·&nbsp;Matias Macazaga</div></header><figure class=entry-cover><img loading=lazy src=https://matimacazaga.github.io/img/portfolio_optimization_2.png alt="Sharpe Ratio portfolio optimization"><p><a href="https://unsplash.com/photos/N__BnvQ_w18?utm_source=unsplash&utm_medium=referral&utm_content=creditShareLink">Source</a></p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#sharpe-ratio>Sharpe Ratio</a><ul><li><a href=#benefits>Benefits</a></li><li><a href=#drawbacks>Drawbacks</a></li><li><a href=#conic-formulation>Conic Formulation</a></li></ul></li><li><a href=#python-implementation>Python Implementation</a></li></ul></nav></div></details></div><div class=post-content><p>This is the second part of the <em>Portfolio Optimization with Python</em> series. In <a href=https://matimacazaga.github.io/posts/portfolio_optimization/>Part I</a>, we introduced the Portfolio Optimization field, the MVO framework and the MOSEK python API for solving a constrained portfolio optimization problem efficiently. This time, we will find the portfolio that maximizes a performance metric called Sharpe Ratio. We will first introduce the Sharpe Ratio and its benefits and drawbacks as a portfolio performance metric. Finally, we will formulate the optimization problem theoretically as a conic problem and solve it using Python.</p><h2 id=sharpe-ratio>Sharpe Ratio<a hidden class=anchor aria-hidden=true href=#sharpe-ratio>#</a></h2><p>Developed by Nobel laureate William F. Sharpe in 1966, the Sharpe Ratio serves as a cornerstone for portfolio evaluation and comparison. This metric enables investors to assess the risk-adjusted return of a portfolio, providing a comprehensive measure of its efficiency. By incorporating both the returns and volatility of a portfolio, the Sharpe Ratio assists investors in making informed decisions, aiming to maximize returns while minimizing risk.</p><p>The Sharpe Ratio is defined as the ratio of the excess return of an investment over the risk-free rate to the standard deviation of the investment&rsquo;s returns. Mathematically, the formula is expressed as:</p><p>\[ SR = \dfrac{R_{p} - R_{f}}{\sigma_{p}}, \]</p><p>where:</p><ul><li>\(SR\) is the Sharpe Ratio.</li><li>\(R_{p}\) denotes the portfolio&rsquo;s expected return.</li><li>\(R_{f}\) signifies the risk-free rate of return.</li><li>\(\sigma_{p}\) represents the standard deviation of the portfolio&rsquo;s returns.</li></ul><p>We can rewrite this formula in terms of the portfolio weights \(\mathbf{x}\), the expected return vector \(\mathbf{\mu}\) and the covariance matrix \(\Sigma\) as follows:</p><p>\[SR = \dfrac{\mathbf{\mu}^{T}\mathbf{x} - r_{f}}{\sqrt{\mathbf{x}^{T}\Sigma \mathbf{x}}}\]</p><h3 id=benefits>Benefits<a hidden class=anchor aria-hidden=true href=#benefits>#</a></h3><p>The benefits of using the Sharpe Ratio are:</p><ol><li>Risk-adjusted Performance: the Sharpe Ratio provides a more comprehensive assessment of portfolio performance. It accounts for the inherent risk associated with investments and helps investors evaluate the potential rewards relative to the level of risk undertaken.</li><li>Comparative Analysis: the Sharpe Ratio allows for straightforward comparisons between different investment portfolios by assessing their risk-adjusted returns.</li><li>Decision Support: this metric aids in decision-making by quantifying the trade-off between returns and risk. An investor can utilize the Sharpe Ratio to identify portfolios with higher expected returns per unit of risk.</li></ol><h3 id=drawbacks>Drawbacks<a hidden class=anchor aria-hidden=true href=#drawbacks>#</a></h3><ol><li>Assumptions of Normality: the Sharpe Ratio assumes that returns follow a normal distribution, which might not always be the case in real-world scenarios.</li><li>Sensitivity to Risk-Free Rate: The choice of an appropriate risk-free rate can significantly impact the Sharpe Ratio. The risk-free rate acts as a benchmark, representing the return an investor would earn from a riskless investment. However, different market conditions and varying interpretations of the risk-free rate can introduce subjectivity and affect the interpretation of the Sharpe Ratio.</li><li>Dependency on Historical Data: the Sharpe Ratio relies on historical data to estimate the average returns and standard deviation of a portfolio. Consequently, it assumes that past performance is indicative of future outcomes.</li></ol><p>While it may not be possible to completely eliminate the drawbacks of the Sharpe Ratio, several approaches can help to mitigate their impact and enhance metric&rsquo;s effectiveness. Although we will not focus on these approaches, here are some strategies to address the drawbacks mentioned above:</p><ul><li>Use other risk-adjusted metrics that are more suitable for modeling non-normal return distributions, such as the Sortino Ratio or the Omega Ratio, which account for downside risk and skweness in return distributions.</li><li>Incorporate Stress Testing and Scenario Analysis to account for extreme market events and analyze portfolio performance in adverse market conditions. This approach can help to refine the risk management strategies.</li><li>Use Robust Portfolio Optimization techniques to incorporate uncertainty by considering a range of potential scenarios, minimizing the impact of extreme events and improving the reliability of risk and return estimates.</li></ul><h3 id=conic-formulation>Conic Formulation<a hidden class=anchor aria-hidden=true href=#conic-formulation>#</a></h3><p>The idea now is to use the Sharpe Ratio metric as the objective function in our optimization problem. In this way, the objective function of the portfolio optimization algorithm is</p><p>\[\text{maximize}_{\mathbf{x}} \dfrac{\mathbf{\mu}^{T}\mathbf{x} - r_f }{||\mathbf{G}^{T}\mathbf{x}||_2}, \]</p><p>where we reformulated the risk term as a 2-norm as in the previous post.</p><p>In order to derive a conic formulation for the objective function above, we should not that if we could fix the term in the numerator</p><p>\[ \mathbf{\mu}^{T}\mathbf{x} - r_{f} = \text{const}, \]</p><p>then the objective would be equivalent to minimizing \(||\mathbf{G}^{T}\mathbf{x}||_2\), which is a standard second-order cone problem.</p><p>We do not know in advance what the constant value should be. Solving this problem for all the possible constant values is equivalent to computing the efficient frontier. We do not want to do that, therefore let&rsquo;s denote the constant value using a new scalar variable \(z\), \(z\geq 0\), as \(\text{const}=1/z\). In this way, we now have</p><p>\[ \mathbf{\mu}^{T}\mathbf{x} - r_{f} = \dfrac{1}{z} \]</p><p>The reason for using \(1/z\) will become obvious in a moment. If we multiply both sides by \(z\), we obtain</p><p>\[z \mathbf{\mu}^{T}\mathbf{x} - r_{f}z = 1 \]</p><p>Denoting \(\mathbf{y}=z\mathbf{x}\), this equation becomes</p><p>\[\mathbf{\mu}^{T}\mathbf{y} - r_{f}z = 1 \]</p><p>Given that \(\mathbf{x} = \mathbf{y}/z\), the objective function becomes</p><p>\[ \dfrac{\mathbf{\mathbf{\mu}^{T}\mathbf{x} - r_{f}}}{||\mathbf{G}^{T}\mathbf{x}||_2}=\dfrac{1/z}{||\mathbf{G}^{T}\mathbf{\frac{y}{z}}||_2} = \dfrac{1}{||\mathbf{G}^{T}\mathbf{y}||_2}, \]</p><p>which allows us to rewrite the original optimization problem as</p><p>\[ \begin{array}{lr} \text{minimize} & ||\mathbf{G}^{T}\mathbf{y}||_{2} \\ \text{subject to} & \mathbf{\mu}^{T}\mathbf{y} - r_f z = 1 \\ & z\geq 0 \end{array} \]</p><p>The new problem involves variables \(\mathbf{y}\) and \(z\), so any additional constraints must be rewritten by substituting \(x=y/z\). For instance, the budget constraint \( \mathbf{1}^{T}\mathbf{x} = 1\) is reformulated as</p><p>\[ \mathbf{1}^{T}\mathbf{y} = z, \ \ \ y\geq 0. \]</p><p>On the other hand, diversification constraints of the form \(l_{i} \leq x_{i} \leq u_{i}\) are rewritten as</p><p>\[ zl_{i} \leq y_{i} \leq zu_{i} \]</p><p>Finally, a solution \(y, z\) to the reformulated optimization problem gives a solution \(x=y/z\) to the original problem.</p><h2 id=python-implementation>Python Implementation<a hidden class=anchor aria-hidden=true href=#python-implementation>#</a></h2><p>The implementation of the portfolio optimization problem in Python closely resembles the approach presented in our <a href=https://matimacazaga.github.io/posts/portfolio_optimization/>previous post</a>. The primary distinction lies in the modification of variables to reframe the problem as a conic optimization problem.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>mosek.fusion</span> <span class=k>as</span> <span class=nn>mf</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>yfinance</span> <span class=k>as</span> <span class=nn>yf</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>altair</span> <span class=k>as</span> <span class=nn>alt</span>
</span></span><span class=line><span class=cl><span class=n>alt</span><span class=o>.</span><span class=n>renderers</span><span class=o>.</span><span class=n>set_embed_options</span><span class=p>(</span><span class=n>actions</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>theme</span><span class=o>=</span><span class=s2>&#34;dark&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>build_model</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>n_assets</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>asset_sectors</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>constraints</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]],</span>
</span></span><span class=line><span class=cl>    <span class=n>risk_free</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.0</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>mf</span><span class=o>.</span><span class=n>Model</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Function for building MOSEK model to solve the mean-variance optimization
</span></span></span><span class=line><span class=cl><span class=s2>    problem with diversification constraints.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Parameters
</span></span></span><span class=line><span class=cl><span class=s2>    ----------
</span></span></span><span class=line><span class=cl><span class=s2>    n_assets : int
</span></span></span><span class=line><span class=cl><span class=s2>        Number of assets in the investment universe.
</span></span></span><span class=line><span class=cl><span class=s2>    asset_sectors : pd.DataFrame
</span></span></span><span class=line><span class=cl><span class=s2>        DataFrame containing assets&#39; names (`&#34;Asset&#34;` column) and their
</span></span></span><span class=line><span class=cl><span class=s2>        corresponding sectors (`&#34;Sector&#34;` column).
</span></span></span><span class=line><span class=cl><span class=s2>    constraints : List[Dict[str, Any]]
</span></span></span><span class=line><span class=cl><span class=s2>        List of diversification constraints (dictionaries). The dictionaries
</span></span></span><span class=line><span class=cl><span class=s2>        must have the following keys:
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        - `&#34;Type&#34;`: type of constraint. It can be `&#34;All Assets&#34;` (the constraint
</span></span></span><span class=line><span class=cl><span class=s2>        applies to all the assets), `&#34;Sectors&#34;` (the constraint applies only
</span></span></span><span class=line><span class=cl><span class=s2>        to assets from a particular sector) or `&#34;Assets&#34;` (the constraint
</span></span></span><span class=line><span class=cl><span class=s2>        applies to a particular asset).
</span></span></span><span class=line><span class=cl><span class=s2>        - `&#34;Weight&#34;`: limit value for the assets&#39; weights.
</span></span></span><span class=line><span class=cl><span class=s2>        - `&#34;Sign&#34;`: domain of the constraint. It can be `&#34;&gt;=&#34;` (greater than) or
</span></span></span><span class=line><span class=cl><span class=s2>        `&#34;&lt;=&#34;` (less than).
</span></span></span><span class=line><span class=cl><span class=s2>        - `&#34;Position&#34;`: indicates to which positions the constraint applies. It
</span></span></span><span class=line><span class=cl><span class=s2>        can be the name of a sector, the name of an asset or an empty string
</span></span></span><span class=line><span class=cl><span class=s2>        (`&#34;&#34;`) if the constraint type is `&#34;All Assets&#34;`.
</span></span></span><span class=line><span class=cl><span class=s2>    risk_free: float
</span></span></span><span class=line><span class=cl><span class=s2>        Risk free rate.
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>    Returns
</span></span></span><span class=line><span class=cl><span class=s2>    -------
</span></span></span><span class=line><span class=cl><span class=s2>    model: mf.Model
</span></span></span><span class=line><span class=cl><span class=s2>        MOSEK model object.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># Creating the model</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span> <span class=o>=</span> <span class=n>mf</span><span class=o>.</span><span class=n>Model</span><span class=p>(</span><span class=s2>&#34;sharpe_ratio&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Auxiliar vector variable y.</span>
</span></span><span class=line><span class=cl>    <span class=n>y</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>variable</span><span class=p>(</span><span class=s2>&#34;y&#34;</span><span class=p>,</span> <span class=n>n_assets</span><span class=p>,</span> <span class=n>mf</span><span class=o>.</span><span class=n>Domain</span><span class=o>.</span><span class=n>greaterThan</span><span class=p>(</span><span class=mf>0.0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Auxiliar scalar variable z.</span>
</span></span><span class=line><span class=cl>    <span class=n>z</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>variable</span><span class=p>(</span><span class=s2>&#34;z&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>mf</span><span class=o>.</span><span class=n>Domain</span><span class=o>.</span><span class=n>greaterThan</span><span class=p>(</span><span class=mf>0.0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Variable for modeling the portfolio variance in the objective function</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>variable</span><span class=p>(</span><span class=s2>&#34;s&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>mf</span><span class=o>.</span><span class=n>Domain</span><span class=o>.</span><span class=n>unbounded</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Parameter for cov matrix decomposition.</span>
</span></span><span class=line><span class=cl>    <span class=n>G</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>parameter</span><span class=p>(</span><span class=s2>&#34;G&#34;</span><span class=p>,</span> <span class=p>[</span><span class=n>n_assets</span><span class=p>,</span> <span class=n>n_assets</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Parameter for expected returns vector.</span>
</span></span><span class=line><span class=cl>    <span class=n>mu</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>parameter</span><span class=p>(</span><span class=s2>&#34;mu&#34;</span><span class=p>,</span> <span class=n>n_assets</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Reformulation constraint</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span><span class=o>.</span><span class=n>constraint</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;reformulation&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>mu</span><span class=p>,</span> <span class=n>y</span><span class=p>),</span> <span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>mul</span><span class=p>(</span><span class=n>risk_free</span><span class=p>,</span> <span class=n>z</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=n>mf</span><span class=o>.</span><span class=n>Domain</span><span class=o>.</span><span class=n>equalsTo</span><span class=p>(</span><span class=mf>1.0</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># Budget constraint (fully invested)</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span><span class=o>.</span><span class=n>constraint</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;budget&#34;</span><span class=p>,</span> <span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>y</span><span class=p>),</span> <span class=n>z</span><span class=p>),</span> <span class=n>mf</span><span class=o>.</span><span class=n>Domain</span><span class=o>.</span><span class=n>equalsTo</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Iterate over the constraints list and add the constraints to the model.</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>c</span><span class=p>,</span> <span class=n>constraint</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>constraints</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>sign</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>mf</span><span class=o>.</span><span class=n>Domain</span><span class=o>.</span><span class=n>greaterThan</span><span class=p>(</span><span class=mf>0.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>constraint</span><span class=p>[</span><span class=s2>&#34;Sign&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;&gt;=&#34;</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span> <span class=n>mf</span><span class=o>.</span><span class=n>Domain</span><span class=o>.</span><span class=n>lessThan</span><span class=p>(</span><span class=mf>0.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>constraint</span><span class=p>[</span><span class=s2>&#34;Type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;All Assets&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>A</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>identity</span><span class=p>(</span><span class=n>n_assets</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>model</span><span class=o>.</span><span class=n>constraint</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=sa>f</span><span class=s2>&#34;c_</span><span class=si>{</span><span class=n>c</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>mul</span><span class=p>(</span><span class=n>A</span><span class=p>,</span> <span class=n>y</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>mul</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=n>constraint</span><span class=p>[</span><span class=s2>&#34;Weight&#34;</span><span class=p>],</span> <span class=n>mf</span><span class=o>.</span><span class=n>Var</span><span class=o>.</span><span class=n>vrepeat</span><span class=p>(</span><span class=n>z</span><span class=p>,</span> <span class=n>n_assets</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=n>sign</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>constraint</span><span class=p>[</span><span class=s2>&#34;Type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;Sectors&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>A</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>asset_sectors</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=s2>&#34;Sector&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=n>constraint</span><span class=p>[</span><span class=s2>&#34;Position&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=mf>1.0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=mf>0.0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>model</span><span class=o>.</span><span class=n>constraint</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=sa>f</span><span class=s2>&#34;c_</span><span class=si>{</span><span class=n>c</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>A</span><span class=p>,</span> <span class=n>y</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>mul</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=n>constraint</span><span class=p>[</span><span class=s2>&#34;Weight&#34;</span><span class=p>],</span> <span class=n>z</span>
</span></span><span class=line><span class=cl>                    <span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=n>sign</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>constraint</span><span class=p>[</span><span class=s2>&#34;Type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;Assets&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>A</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>asset_sectors</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=s2>&#34;Asset&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=n>constraint</span><span class=p>[</span><span class=s2>&#34;Position&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=mf>1.0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=mf>0.0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>model</span><span class=o>.</span><span class=n>constraint</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=sa>f</span><span class=s2>&#34;c_</span><span class=si>{</span><span class=n>c</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>A</span><span class=p>,</span> <span class=n>y</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>mul</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=n>constraint</span><span class=p>[</span><span class=s2>&#34;Weight&#34;</span><span class=p>],</span> <span class=n>z</span>
</span></span><span class=line><span class=cl>                    <span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=n>sign</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Conic constraint for the portfolio variance</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span><span class=o>.</span><span class=n>constraint</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;risk&#34;</span><span class=p>,</span> <span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>vstack</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>mf</span><span class=o>.</span><span class=n>Expr</span><span class=o>.</span><span class=n>mul</span><span class=p>(</span><span class=n>G</span><span class=p>,</span> <span class=n>y</span><span class=p>)),</span> <span class=n>mf</span><span class=o>.</span><span class=n>Domain</span><span class=o>.</span><span class=n>inQCone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Define objective function</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span><span class=o>.</span><span class=n>objective</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;obj&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>mf</span><span class=o>.</span><span class=n>ObjectiveSense</span><span class=o>.</span><span class=n>Minimize</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>model</span>
</span></span></code></pre></td></tr></table></div></div><p>We will employ the identical investment universe and constraints as outlined in the previous post. Our objective is to obtain the vector variable \(\mathbf{y}\) and the scalar variable \(z\), which will be utilized to derive the optimal portfolio weights by calculating their ratio.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Get optimal weights from the Model object.</span>
</span></span><span class=line><span class=cl><span class=n>weights</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>constrained_model</span><span class=o>.</span><span class=n>getVariable</span><span class=p>(</span><span class=s2>&#34;y&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>level</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=o>/</span> <span class=n>constrained_model</span><span class=o>.</span><span class=n>getVariable</span><span class=p>(</span><span class=s2>&#34;z&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>level</span><span class=p>()[</span><span class=mi>0</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>index</span><span class=o>=</span><span class=n>asset_sectors</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=s2>&#34;Asset&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=o>=</span><span class=s2>&#34;Constrained&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>.</span><span class=n>to_frame</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>weights</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=s2>&#34;Unconstrained&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>unconstrained_model</span><span class=o>.</span><span class=n>getVariable</span><span class=p>(</span><span class=s2>&#34;y&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>level</span><span class=p>()</span> <span class=o>/</span> 
</span></span><span class=line><span class=cl>    <span class=n>unconstrained_model</span><span class=o>.</span><span class=n>getVariable</span><span class=p>(</span><span class=s2>&#34;z&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>level</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>The plot below illustrates the portfolio weights for both the constrained and unconstrained cases. Once again, we observe that the imposition of constraints leads to the selection of a greater number of assets.</p><iframe src=/altair_plots/weights_comparison_sharpe_ratio.html width=600px height=420px></iframe><p>We can utilize the following function to calculate the Sharpe Ratio of the portfolios and assess the influence of the constraints on its value.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_portfolio_sharpe_ratio</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>weights</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span> <span class=o>|</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>mu</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span> <span class=o>|</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>sigma</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span> <span class=o>|</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>ann_factor</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>252</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Computes the Annualized Sharpe Ratio.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Parameters
</span></span></span><span class=line><span class=cl><span class=s2>    ----------
</span></span></span><span class=line><span class=cl><span class=s2>    weights : np.ndarray | pd.Series
</span></span></span><span class=line><span class=cl><span class=s2>        Portfolio weights.
</span></span></span><span class=line><span class=cl><span class=s2>    mu : np.ndarray | pd.Series
</span></span></span><span class=line><span class=cl><span class=s2>        Expected return.
</span></span></span><span class=line><span class=cl><span class=s2>    sigma : np.ndarray | pd.DataFrame
</span></span></span><span class=line><span class=cl><span class=s2>        Covariance matrix.
</span></span></span><span class=line><span class=cl><span class=s2>    ann_factor : int, optional
</span></span></span><span class=line><span class=cl><span class=s2>        Annualization factor, by default 252.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Returns
</span></span></span><span class=line><span class=cl><span class=s2>    -------
</span></span></span><span class=line><span class=cl><span class=s2>    float
</span></span></span><span class=line><span class=cl><span class=s2>        Sharpe Ratio.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>std_dev</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>np</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>np</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>weights</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>sigma</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>weights</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>expected_return</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>weights</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>mu</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=n>expected_return</span><span class=o>/</span><span class=n>std_dev</span><span class=p>)</span><span class=o>*</span><span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>ann_factor</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>The constrained portfolio exhibits a Sharpe Ratio of 0.95, whereas the unconstrained version achieves a ratio of 1.10. It is important to note that these calculations rely on historical data, and future portfolio performance may deviate from these values. While the constrained portfolio&rsquo;s Sharpe Ratio is lower than that of the unconstrained version, it is possible that the constraints have positively impacted other significant risk metrics. To further analyze this, a backtest will be performed, as detailed in the upcoming post.</p><h1 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h1><p>We have explored the use of the Sharpe Ratio in portfolio optimization and management, highlighting its benefits and limitations. The Sharpe Ratio provides a valuable metric for evaluating risk-adjusted returns and aiding investment decision-making. While it offers insights into portfolio efficiency, it is crucial to consider its assumptions and potential drawbacks.</p><p>To further deepen our analysis and gain a comprehensive understanding of the impact of constraints on portfolio performance, the next post will delve into the execution of a backtest. Using Python&rsquo;s <code>bt</code> library, we will demonstrate how to conduct a thorough evaluation by simulating the historical performance of constrained and unconstrained portfolios. This will enable us to assess their risk-return trade-offs and gain valuable insights into the efficacy of the portfolio optimization strategies employed.</p><p>You can find the full code <a href=https://github.com/matimacazaga/portfolio_optimization_with_mosek>here</a> in the <code>sharpe_ratio.ipynb</code> notebook.</p><p>Stay tuned for the next post, where we will explore the intricacies of backtesting and how it can enhance our understanding of portfolio performance in real-world scenarios.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://matimacazaga.github.io/tags/mosek/>MOSEK</a></li><li><a href=https://matimacazaga.github.io/tags/python/>Python</a></li><li><a href=https://matimacazaga.github.io/tags/portfolio-optimization/>Portfolio Optimization</a></li><li><a href=https://matimacazaga.github.io/tags/efficient-frontier/>Efficient Frontier</a></li><li><a href=https://matimacazaga.github.io/tags/sharpe-ratio/>Sharpe Ratio</a></li></ul><nav class=paginav><a class=next href=https://matimacazaga.github.io/posts/portfolio_optimization/><span class=title>Next »</span><br><span>Portfolio Optimization with Python - Part I</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Portfolio Optimization with Python - Part II on twitter" href="https://twitter.com/intent/tweet/?text=Portfolio%20Optimization%20with%20Python%20-%20Part%20II&url=https%3a%2f%2fmatimacazaga.github.io%2fposts%2fportfolio_optimization_max_sharpe%2f&hashtags=MOSEK%2cPython%2cPortfolioOptimization%2cEfficientFrontier%2cSharpeRatio"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Portfolio Optimization with Python - Part II on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fmatimacazaga.github.io%2fposts%2fportfolio_optimization_max_sharpe%2f&title=Portfolio%20Optimization%20with%20Python%20-%20Part%20II&summary=Portfolio%20Optimization%20with%20Python%20-%20Part%20II&source=https%3a%2f%2fmatimacazaga.github.io%2fposts%2fportfolio_optimization_max_sharpe%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Portfolio Optimization with Python - Part II on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fmatimacazaga.github.io%2fposts%2fportfolio_optimization_max_sharpe%2f&title=Portfolio%20Optimization%20with%20Python%20-%20Part%20II"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Portfolio Optimization with Python - Part II on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fmatimacazaga.github.io%2fposts%2fportfolio_optimization_max_sharpe%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Portfolio Optimization with Python - Part II on whatsapp" href="https://api.whatsapp.com/send?text=Portfolio%20Optimization%20with%20Python%20-%20Part%20II%20-%20https%3a%2f%2fmatimacazaga.github.io%2fposts%2fportfolio_optimization_max_sharpe%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Portfolio Optimization with Python - Part II on telegram" href="https://telegram.me/share/url?text=Portfolio%20Optimization%20with%20Python%20-%20Part%20II&url=https%3a%2f%2fmatimacazaga.github.io%2fposts%2fportfolio_optimization_max_sharpe%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://matimacazaga.github.io/>MM</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script type=text/x-mathjax-config> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "all" } } }); </script><script type=text/javascript src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>